---
alwaysApply: true
---
# Правила разработки кода

## Общие принципы

- **Простота превыше всего** — пиши самый простой код, который работает
- **Без абстракций** — не создавай классы, интерфейсы, паттерны без необходимости
- **Без "на будущее"** — реализуй только то, что нужно сейчас
- **Понятный код** — код должен быть самодокументируемым

## Стиль кода

- Следовать **PEP 8**
- Имена функций и переменных — `snake_case`
- Имена констант — `UPPER_SNAKE_CASE`
- Максимальная длина строки — 100 символов
- Отступы — 4 пробела

## Асинхронность

- **Все функции, работающие с I/O, должны быть async**
- Использовать `async def` для обработчиков сообщений
- Использовать `await` для всех асинхронных вызовов
- Не блокировать event loop (не использовать синхронные вызовы внутри async функций без обертки)

## Структура кода

- **Простые функции** — одна функция = одна задача
- **Без классов** — используй функции и словари, если классы не нужны
- **Прямолинейная логика** — без сложных условий и вложенности (максимум 2-3 уровня)

## Именование

- **Понятные имена** — `user_id` вместо `uid`, `message_history` вместо `msgs`
- **Глаголы для функций** — `get_response`, `send_message`, `clear_history`
- **Существительные для переменных** — `history`, `response`, `user_id`

## Обработка ошибок

- **Минимальная обработка** — только критичные ошибки
- Использовать `try/except` только когда нужно
- Логировать ошибки через `logging.error()`
- Не обрабатывать ошибки, если не знаешь, что с ними делать

## Комментарии

- **Код вместо комментариев** — если код непонятен, упрости его
- Комментарии только для объяснения "почему", а не "что"
- Docstrings не обязательны для простых функций

## Импорты

- **Стандартная библиотека сверху** — сначала `import logging`, потом сторонние библиотеки
- **Одна строка — один импорт** для сторонних библиотек
- Импорты в начале файла
- Не использовать `from module import *`

## Типы данных

- **Простая структура** — списки и словари, без кастомных классов
- Использовать типы из стандартной библиотеки (`dict`, `list`, `int`, `str`)
- Для истории диалога: `dict[int, list[dict]]` где `list[dict]` содержит `{"role": str, "content": str}`

## Модули

- **Один файл — одна ответственность**
- `main.py` — только запуск приложения
- `bot.py` — только обработка Telegram сообщений
- `llm.py` — только работа с LLM API

## Конфигурация

- Загружать переменные окружения в `main.py`
- Использовать `os.getenv()` с дефолтными значениями
- Не хардкодить значения (кроме системного промпта, если он не в .env)

## Логирование

- Использовать стандартный `logging` модуль
- `logger.info()` для основных событий
- `logger.error()` для ошибок
- Не логировать содержимое сообщений и ответов LLM

